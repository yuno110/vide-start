#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# í”„ë¡ íŠ¸ì—”ë“œ ì²´í¬
if [ -d "frontend" ]; then
  echo ""
  echo "ğŸ“± Checking frontend..."
  cd frontend

  # Lint ì²´í¬
  if [ -f "package.json" ] && grep -q "\"lint\"" package.json; then
    echo "  â”œâ”€ Running ESLint..."
    npm run lint || exit 1
  fi

  # íƒ€ì… ì²´í¬
  if [ -f "tsconfig.json" ]; then
    echo "  â”œâ”€ Type checking..."
    npx tsc --noEmit || exit 1
  fi

  # ë¹Œë“œ í…ŒìŠ¤íŠ¸
  if [ -f "package.json" ] && grep -q "\"build\"" package.json; then
    echo "  â”œâ”€ Building..."
    npm run build || exit 1
  fi

  # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  if [ -f "package.json" ] && grep -q "\"test\"" package.json; then
    echo "  â””â”€ Running tests..."
    npm test -- --run || exit 1
  fi

  cd ..
else
  echo ""
  echo "â„¹ï¸  Frontend directory not found, skipping frontend checks."
fi

# ë°±ì—”ë“œ ì²´í¬
if [ -d "backend" ]; then
  echo ""
  echo "â˜• Checking backend..."
  cd backend

  # Checkstyle (ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬)
  if [ -f "gradlew" ]; then
    echo "  â”œâ”€ Running Checkstyle..."
    ./gradlew checkstyleMain checkstyleTest || exit 1
  fi

  # ë¹Œë“œ í…ŒìŠ¤íŠ¸
  if [ -f "gradlew" ]; then
    echo "  â”œâ”€ Building..."
    ./gradlew build -x test || exit 1
  fi

  # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  if [ -f "gradlew" ]; then
    echo "  â””â”€ Running tests..."
    ./gradlew test || exit 1
  fi

  cd ..
else
  echo ""
  echo "â„¹ï¸  Backend directory not found, skipping backend checks."
fi

echo ""
echo "âœ… All checks passed!"
